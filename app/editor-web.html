<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/theme/monokai.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/codemirror.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/addon/hint/show-hint.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="./js/auto-complete.js"></script>
    <link rel="stylesheet" href="css/editor.css" />
  </head>
  <body>
    <!-- Barra de navegação -->
    <header id="header" class="header">
      <a href="/Icones/icon.png">Icon</a>
  </header>
<nav class="dp-menu">
    <ul>
        <li><img style="padding-top: 10px; margin-left: 10px;" src="images/phoenix-squadron-16.png"></li>
        <li><a href="#">Arquivos</a>
            <ul>
                <li><a href="#">Novo Projeto</a></li>
                <li><a href="#">Abrir Arquivo</a></li>
                <li><a href="#">Salvar Arquivo</a></li>
                <li><a href="#">Salvar Arquivo em Zip</a></li>
            </ul>
        </li>
        <li><a href="#">Editar</a>
            <ul>
                <li><a href="#">Copiar</a></li>
                <li><a href="#">Colar</a></li>
                <li><a href="#">Apagar Tudo</a></li>
            </ul>
        </li>
        <li><a href="#">Execultar</a>
            <ul>
                <li><a href="#">Visualizar</a></li>
            </ul>
        </li>
        <li><a href="#">Preferencias</a>
            <ul>
                <li><a href="#">Tela Cheia</a></li>
                <li><a href="#">Tema do Editor</a></li>
            </ul>
        </li>
        <li><a href="#">Documentação</a>
            <ul>
                <li><a href="#">Atalhos</a></li>
            </ul>
        </li>
        <li><a href="#">Sobre</a>
            <ul>
                <li><a href="#">versão</a></li>
                <li><a href="#">Criadores</a></li>
                <li><a href="#">Github</a></li>
            </ul>
        </li>
    </ul>
</nav>
    <!-- Campo do editor de código-->
    <div class="conteiner-editor">
      <textarea  id="editor"></textarea>
      <iframe id="iframe-prev"class="iframe-preview"></iframe>
    </div>
    
    <!-- input file onde o usuario ira escolher so seu sistema um arquivo nos formatos definidos -->
    <input style="display: none;" type="file" id="inputFile" accept=".js, .json, .html, .css">
    <button onclick="previewWindow()">Visualizar</button>
    <button onclick="previewIframe()">Visualizar</button>
    <button onclick="gerarZip()">Gerar ZIP</button>
    
    <script>
      let myWords = html5Syntax();
      // Seta as configurações do edditor
      const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
        mode: "htmlmixed", //htmlmixed  modo composto que inclui o html, javascript e css.
        theme: "monokai",
        lineNumbers: true,
        extraKeys: { "Ctrl-Space": "autocomplete" },
        hintOptions: {
           completeSingle: true,
           hint: myHintFunction}
      });

      // Função para sujestões de código
      function myHintFunction(editor) {
        var cursor = editor.getCursor();
        var token = editor.getTokenAt(cursor);
        var start = token.start;
        var end = cursor.ch;
        var line = cursor.line;
        var currentWord = token.string;
        var wordList = myWords.filter(function (word) {
          return word.startsWith(currentWord);
        });
        if (wordList.length > 0) {
          return {
            list: wordList,
            from: CodeMirror.Pos(line, start),
            to: CodeMirror.Pos(line, end)
          };
        }
      }

      // carregando um arquivo
      const inputFile = document.getElementById("inputFile");
      inputFile.addEventListener("change", () => {
      const file = inputFile.files[0];
      const reader = new FileReader();
      reader.onload = (event) => {
        const content = event.target.result;
        editor.setValue(content);
      };
      reader.readAsText(file);
      });

      //preview em nova janela
      function previewWindow() {
        var code = editor.getValue();
        var previewWindow = window.open("", "preview", "width=800,height=600");
        previewWindow.document.open();
        previewWindow.document.write('');
        previewWindow.document.write(code);
        previewWindow.onbeforeunload = function() {
        previewWindow.close();
      };
    }

     // Atualizar o conteúdo do iframe
    function previewIframe() {
      var code = editor.getValue();
      var iframe = document.getElementById("iframe-prev");
      var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      iframeDoc.open();
      iframeDoc.write(code);
      iframeDoc.close();
    }


    // gerar o arquivo ZIP e baixá-lo no navegador
    function gerarZip() {
      var zip = new JSZip();
      zip.file("arquivo1.txt", editor.getValue());
      //zip.file("arquivo2.txt", "Conteúdo do arquivo 2");
      zip.file("imagem.jpg", "conteúdo da imagem", {base64: false});
      zip.generateAsync({type:"blob"}).then(function(content) {
      saveAs(content, "arquivos.zip");
      });
    }
    
    </script>
  </body>
</html>
